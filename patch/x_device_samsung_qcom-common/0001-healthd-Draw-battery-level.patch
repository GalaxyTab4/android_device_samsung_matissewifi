From 9644e5557f7077189923cd7b8f7336987ef4528d Mon Sep 17 00:00:00 2001
From: Fenglin Wu <fenglinw@codeaurora.org>
Date: Wed, 18 Nov 2015 05:23:45 +0100
Subject: [PATCH] healthd: Draw battery level

Change-Id: Ifd6312e0900c999facb8c924ff41edd11fdd94dc
---
 libhealthd/Android.mk                |  2 +-
 libhealthd/healthd_board_default.cpp | 24 +++++++++++++++++++-----
 2 files changed, 20 insertions(+), 6 deletions(-)

diff --git a/libhealthd/Android.mk b/libhealthd/Android.mk
index eac4065..24a6c75 100644
--- a/libhealthd/Android.mk
+++ b/libhealthd/Android.mk
@@ -18,6 +18,6 @@ LOCAL_PATH := $(call my-dir)
 include $(CLEAR_VARS)
 LOCAL_SRC_FILES := healthd_board_default.cpp
 LOCAL_MODULE := libhealthd.qcom
-LOCAL_C_INCLUDES := system/core/healthd
+LOCAL_C_INCLUDES := system/core/healthd bootable/recovery
 include $(BUILD_STATIC_LIBRARY)
 
diff --git a/libhealthd/healthd_board_default.cpp b/libhealthd/healthd_board_default.cpp
index 8888958..d6ade7c 100644
--- a/libhealthd/healthd_board_default.cpp
+++ b/libhealthd/healthd_board_default.cpp
@@ -16,6 +16,7 @@
  */
 
 #include <healthd.h>
+#include "minui/minui.h"
 
 void healthd_board_init(struct healthd_config *config)
 {
@@ -28,6 +29,24 @@ void healthd_board_init(struct healthd_config *config)
     config->batteryTechnologyPath  = "/sys/class/power_supply/battery/technology";
 }
 
+#define STR_LEN 8
+void healthd_board_mode_charger_draw_battery(
+                struct android::BatteryProperties *batt_prop)
+{
+    char cap_str[STR_LEN];
+    int x, y;
+    int str_len_px;
+    static int char_height = -1, char_width = -1;
+
+    if (char_height == -1 && char_width == -1)
+        gr_font_size(&char_width, &char_height);
+    snprintf(cap_str, (STR_LEN - 1), "%d%%", batt_prop->batteryLevel);
+    str_len_px = gr_measure(cap_str);
+    x = (gr_fb_width() - str_len_px) / 2;
+    y = (gr_fb_height() + char_height) / 2;
+    gr_color(0xa4, 0xc6, 0x39, 255);
+    gr_text(x, y, cap_str, 0);
+}
 
 int healthd_board_battery_update(__attribute__((unused)) struct android::BatteryProperties *props)
 {
@@ -35,11 +54,6 @@ int healthd_board_battery_update(__attribute__((unused)) struct android::Battery
     return 1;
 }
 
-void healthd_board_mode_charger_draw_battery(struct android::BatteryProperties*)
-{
-
-}
-
 void healthd_board_mode_charger_battery_update(struct android::BatteryProperties*)
 {
 
-- 
1.9.1

